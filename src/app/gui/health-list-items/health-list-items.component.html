<h1 style="text-align: center">{{categorySpec ? categorySpec.label : ''}}</h1>

<table mat-table [dataSource]="pointDataList" [trackBy]="trackItem" class="mat-elevation-z8">

  <ng-container *ngFor="let key of displayedColumns" matColumnDef={{key}}>
    <th mat-header-cell *matHeaderCellDef> {{key === 'date' ? 'Datum' : categorySpec.dataTypes.get(key).label}} </th>
    <td mat-cell *matCellDef="let dataPoint;">
      <div *ngIf="key !== 'date' && categorySpec.dataTypes.get(key).type === dataTypeEnum.CODED_TEXT">

        <mat-form-field>
          <mat-select [value]="data.get(dataPoint).get(key)" (selectionChange)="dataPoint.set(key, $event.value)">
            <mat-option>-</mat-option>
            <mat-option *ngFor="let option of options.get(key)" [value]="option.code">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>
      <div *ngIf="key !== 'date' && categorySpec.dataTypes.get(key).type === dataTypeEnum.TEXT">

        <form>
          <input #textInput (change)="dataPoint.set(key, textInput.value)" [value]="dataPoint.get(key) ? dataPoint.get(key) : ''" placeholder={{categorySpec.dataTypes.get(key).label}}>
        </form>

      </div>
      <div *ngIf="key === 'date' || (categorySpec.dataTypes.get(key).type != dataTypeEnum.CODED_TEXT && categorySpec.dataTypes.get(key).type != dataTypeEnum.TEXT)">

        {{data.get(dataPoint).get(key)}}

      </div>

    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<button mat-stroked-button color="accent" style="text-align: center; width: 100%" (click)="openDialog()">Lägg till datavärde</button>
