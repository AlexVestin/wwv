

<div *ngIf="isSmallScreen()">
  <div style="display: flex; flex-direction: row; height: 20px;">
    <h5 style="margin-top: 0px; margin-bottom: 0px; background-color: #efefef; padding: 4px;">
      {{ categorySpec && isEditable ? categorySpec.label + mathOption + intervalOption : '' }}
    </h5>
    <p style="text-align: left">
      {{ categorySpec && !isEditable ? mathOption.substring(2) + intervalOption : ''}}
    </p>
  </div>
</div>

<div class="table-container">
<table
  style="text-align: left"
  class="table"
  mat-table
  [dataSource]="dataList"
  [trackBy]="trackItem"
>
  <ng-container *ngFor="let key of displayedColumns" matColumnDef="{{ key }}">
    <!-- SELECT CHECK BOX  -->
    <div *ngIf="key === 'select'">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="$event ? masterToggle() : null"
          [checked]="selection.hasValue() && isAllSelected()"
        >
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)"
        >
        </mat-checkbox>
      </td>
    </div>

    <!-- DATA COLUMNS -->
    <div *ngIf="!shouldHide(key)">
      
      <!-- HEADER FOR INPUT -->
      <th
        mat-header-cell
        *matHeaderCellDef
        style="text-align: center;"
        [matTooltip]="getCategoryTooltip(key)"
      >
        <div style="display: flex; flex-direction: column;">
          <div>{{ getCategoryLabel(key) }}</div>
          <div *ngIf="isSmallScreen()">{{ getCategoryUnit(key) }}</div>
        </div>
      </th>

      <!-- INPUT -->
      <td mat-cell *matCellDef="let dataPoint">
        <div [ngSwitch]="getDataType(key)">
          <mat-form-field *ngSwitchCase="'select'">
            <mat-select
              [value]="dataPoint.get(key)"
              (selectionChange)="dataPoint.set(key, $event.value)"
            >
              <mat-option [matTooltip]="'obestämd'" matTooltipPosition="left"
                >-</mat-option
              >
              <mat-option
                *ngFor="let option of options.get(key)"
                [value]="option.code"
                [matTooltip]="option.description"
                matTooltipPosition="left"
              >
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field *ngSwitchCase="'text-input'">
            <input
              #textInput
              matInput
              (change)="dataPoint.set(key, textInput.value)"
              [value]="dataPoint.get(key) ? dataPoint.get(key) : ''"
              placeholder="{{ categorySpec.dataTypes.get(key).label }}"
            />
          </mat-form-field>

          <div *ngSwitchCase="'text'" style="text-align: center">
            {{ getTextFromPoint(key, dataPoint) }}
          </div>
        </div>
      </td>

      <!-- MOBILE EDIT BUTTON -->
    </div>
    <div *ngIf="key === 'mobile'">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let dataPoint" style="text-align: center;" >
        <mat-icon (click)="openEditDialog(dataPoint, key)">
          edit
        </mat-icon>
      </td>
    </div>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>
</div>

<div class="small">
  <mat-paginator
    [hidePageSize]="isSmallScreen()"
    [pageSizeOptions]=" [5, 10, 15, 30, 50]"
    showFirstLastButtons
  ></mat-paginator>
</div>
<div class="flex">
  <button
    *ngIf="isEditable"
    style="margin: 0;"
    mat-stroked-button
    color="accent"
    style="text-align: center;"
    (click)="openDialog()"
  >
    <div fxHide fxHide.lt-sm="true">Lägg till datavärde</div>
    <div fxHide.lt-sm="false">Lägg till</div>
  </button>
  <button
    *ngIf="isEditable"
    style="margin: 0;"
    mat-stroked-button
    color="accent"
    style="text-align: center;"
    (click)="openRemovalDialog()"
  >
    <div fxHide fxHide.lt-sm="true">
      Ta bort datavärden, {{ selection.selected.length }} valda
    </div>
    <div fxHide.lt-sm="false">Ta bort ({{ selection.selected.length }})</div>
  </button>
  <button
    *ngIf="isEditable"
    style="margin: 0;"
    mat-stroked-button
    color="accent"
    style="text-align: center;"
    (click)="openMathDialog()"
  >
    <div fxHide fxHide.lt-sm="true">Sammanställ punkter</div>
    <div fxHide.lt-sm="false">Sammanställ</div>
  </button>
</div>
